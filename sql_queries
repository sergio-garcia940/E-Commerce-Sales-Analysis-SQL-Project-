01_monthly_revenue.sql

SELECT
  FORMAT_DATE('%Y-%m', DATE(order_purchase_timestamp)) AS year_month,
  ROUND(SUM(payment_value),2) AS total_revenue
FROM `ecommerce_analysis.olist_orders_dataset` o
JOIN `ecommerce_analysis.olist_order_payments_dataset` p
  ON o.order_id = p.order_id
WHERE o.order_status = 'delivered'
GROUP BY year_month
ORDER BY year_month;

02_mom_growth.sql

WITH monthly_revenue AS (
  SELECT
    FORMAT_DATE('%Y-%m', DATE(order_purchase_timestamp)) AS year_month,
    SUM(payment_value) AS total_revenue
  FROM `ecommerce_analysis.olist_orders_dataset` o
  JOIN `ecommerce_analysis.olist_order_payments_dataset` p
    ON o.order_id = p.order_id
  WHERE o.order_status = 'delivered'
  GROUP BY year_month
)

SELECT
  year_month,
  ROUND(total_revenue,2) AS total_revenue,
  ROUND(
    100 * (total_revenue - LAG(total_revenue) OVER (ORDER BY year_month))
    / LAG(total_revenue) OVER (ORDER BY year_month),
  2) AS mom_growth_percent
FROM monthly_revenue
ORDER BY year_month;

03_top_categories.sql

WITH category_revenue AS (
  SELECT
    pr.product_category_name,
    SUM(oi.price + oi.freight_value) AS revenue
  FROM `ecommerce_analysis.olist_orders_dataset` o
  JOIN `ecommerce_analysis.olist_order_items_dataset` oi
    ON o.order_id = oi.order_id
  JOIN `ecommerce_analysis.olist_products_dataset` pr
    ON oi.product_id = pr.product_id
  WHERE o.order_status = 'delivered'
  GROUP BY pr.product_category_name
)

SELECT
  product_category_name,
  ROUND(revenue,2) AS total_revenue
FROM category_revenue
ORDER BY total_revenue DESC
LIMIT 10;

04_top_customers.sql
WITH customer_metrics AS (
  SELECT
    c.customer_unique_id,
    COUNT(DISTINCT o.order_id) AS total_orders,
    SUM(oi.price + oi.freight_value) AS total_revenue
  FROM `ecommerce_analysis.olist_orders_dataset` o
  JOIN `ecommerce_analysis.olist_order_items_dataset` oi
    ON o.order_id = oi.order_id
  JOIN `ecommerce_analysis.olist_customers_dataset` c
    ON o.customer_id = c.customer_id
  WHERE o.order_status = 'delivered'
  GROUP BY c.customer_unique_id
)
SELECT
  customer_unique_id,
  total_orders,
  ROUND(total_revenue,2) AS total_revenue,
  CASE
    WHEN total_revenue >= 1000 THEN 'VIP'
    WHEN total_revenue BETWEEN 300 AND 999 THEN 'Regular'
    ELSE 'Low Value'
  END AS customer_segment
FROM customer_metrics
ORDER BY total_revenue DESC;

05_customer_segmentation.sql

WITH customer_metrics AS (
  SELECT
    c.customer_unique_id,
    COUNT(DISTINCT o.order_id) AS total_orders,
    SUM(oi.price + oi.freight_value) AS total_revenue
  FROM `ecommerce_analysis.olist_orders_dataset` o
  JOIN `ecommerce_analysis.olist_order_items_dataset` oi
    ON o.order_id = oi.order_id
  JOIN `ecommerce_analysis.olist_customers_dataset` c
    ON o.customer_id = c.customer_id
  WHERE o.order_status = 'delivered'
  GROUP BY c.customer_unique_id
)
SELECT
  customer_unique_id,
  total_orders,
  ROUND(total_revenue,2) AS total_revenue,
  CASE
    WHEN total_revenue >= 1000 THEN 'VIP'
    WHEN total_revenue BETWEEN 300 AND 999 THEN 'Regular'
    ELSE 'Low Value'
  END AS customer_segment
FROM customer_metrics
ORDER BY total_revenue DESC;

06_payment_analysis.sql

WITH payment_summary AS (
  SELECT
    payment_type,
    SUM(payment_value) AS total_revenue,
    COUNT(DISTINCT order_id) AS total_orders
  FROM `ecommerce_analysis.olist_order_payments_dataset`
  GROUP BY payment_type
)

SELECT
  payment_type,
  ROUND(total_revenue,2) AS total_revenue,
  total_orders,
  ROUND(total_revenue / total_orders,2) AS avg_order_value
FROM payment_summary
ORDER BY total_revenue DESC;

